module Phrases
  module Markov
    class Builder
      attr_accessor :phrases
      attr_reader :file_name

      DEFAULT_FILE_NAME = 'data/CNN.yml'
      NO_HASHTAGS = /#.+/
      NO_HTTP = /http.+/
      NO_MENTIONS = /@.+/
      ONLY_WORDS = /\W+/

      def initialize(file_name = DEFAULT_FILE_NAME)
        @file_name = file_name
        @phrases = File.exists?(file_name) ? YAML.load_file(file_name) : {}
      end

      def learn_from_text(text, write = true)
        words = text.split(' ')
        words.each.with_index do |word, i|
          break if i == words.size - 1
          current_word = clean_word(word)
          next_word = clean_word(words[i + 1])

          learn(current_word, next_word, false)
        end

        save_file if write
      end

      private

      def clean_word(word)
        word.gsub(NO_HTTP, '')
            .gsub(NO_HASHTAGS, '')
            .gsub(NO_MENTIONS, '')
            .gsub(ONLY_WORDS, '')
      end

      def learn(current_word, next_word, write = true)
        return if current_word.empty? || next_word.empty?

        phrases[current_word] ||= {}
        phrases[current_word][:_total] ||= 0
        phrases[current_word][:_total] += 1
        phrases[current_word][next_word] ||= 0
        phrases[current_word][next_word] += 1
        save_file if write
      end

      def save_file
        File.write(file_name, phrases.to_yaml)
      end
    end
  end
end

# puts Phrases::Markov::Generator.new.generate('the', 5).join(' ')

# Phrases::Markov::Builder.new.learn_from_text(
#   'Modern European and American history is centered around the effort to gain freedom from the political, economic, and spiritual shackles that have bound men. The battles for freedom were fought by the oppressed, those who wanted new liberties, against those who had privileges to defend. While a class was fighting for its own liberation from domination, it believed itself to be fighting for human freedom as such and thus was able to appeal to an ideal, to the longing for freedom rooted in all who are oppressed. In the long and virtually continuous battle for freedom, however, classes that were fighting against oppression at one stage sided with the enemies of freedom when victory was won and new privileges were to be defended. Despite many reverses, freedom has won battles. Many died in those battles in the conviction that to die in the struggle against oppression was better than to live without freedom. Such a death was the utmost assertion of their individuality. History seemed to be proving that it was possible for man to govern himself, to make decisions for himself, and to think and feel as he saw fit. The full expression of man’s potentialities seemed to be the goal toward which social development was rapidly approaching. The principles of economic liberalism, political democracy, religious autonomy, and individualism in personal life, gave expression to the longing for freedom, and at the same time seemed to bring mankind nearer to its realization. One tie after another was severed. Man had overthrown the domination of nature and made himself her master; he had overthrown the domination of the Church and the domination of the absolutist state. The abolition of external domination seemed to be not only a necessary but also a sufficient condition to attain the cherished goal: freedom of the individual. The First World War was regarded by many as the final struggle and its conclusion the ultimate victory for freedom. Existing democracies appeared strengthened, and new ones replaced old monarchies. But only a few years elapsed before new systems emerged which denied everything that men believed they had won in centuries of struggle. For the essence of these new systems, which effectively took command of man’s entire social and personal life, was the submission of all but a handful of men to an authority over which they had no control. At first many found comfort in the thought that the victory of the authoritarian system was due to the madness of a few individuals and that their madness would lead to their downfall in due time. Others smugly believed that the Italian people, or the Germans, were lacking in a sufficiently long period of training in democracy, and that therefore one could wait complacently until they had reached the political maturity of the Western democracies. Another common illusion, perhaps the most dangerous of all, was that men like Hitler had gained power over the vast apparatus of the state through nothing but cunning and trickery, that they and their satellites ruled merely by sheer force; that the whole population was only the will-less object of betrayal and terror. In the years that have elapsed since, the fallacy of these arguments has become apparent. We have been compelled to recognize that millions in Germany were as eager to surrender their freedom as their fathers were to fight for it; that instead of wanting freedom, they sought for ways of escape from it; that other millions were indifferent and did not believe the defense of freedom to be worth fighting and dying for. We also recognize that the crisis of democracy is not a peculiarly Italian or German problem, but one confronting every modern state. Nor does it matter which symbols the enemies of human freedom choose: freedom is not less endangered if attacked in the name of anti-Fascism than in that of outright Fascism.1 This truth has been so forcefully formulated by John Dewey that I express the thought in his words: “The serious threat to our democracy,” he says, “is not the existence of foreign totalitarian states. It is the existence within our own personal attitudes and within our own institutions of conditions which have given a victory to external authority, discipline, uniformity and dependence upon The Leader in foreign countries. The battlefield is also accordingly here—within ourselves and our institutions.”2 If we want to fight Fascism we must understand it. Wishful thinking will not help us. And reciting optimistic formulae will prove to be as inadequate and useless as the ritual of an Indian rain dance. In addition to the problem of the economic and social conditions which have given rise to Fascism, there is a human problem which needs to be understood. It is the purpose of this book to analyze those dynamic factors in the character structure of modern man, which made him want to give up freedom in Fascist countries and which so widely prevail in millions of our own people. These are the outstanding questions that arise when we look at the human aspect of freedom, the longing for submission, and the lust for power: What is freedom as a human experience? Is the desire for freedom something inherent in human nature? Is it an identical experience regardless of what kind of culture a person lives in, or is it something different according to the degree of individualism reached in a particular society? Is freedom only the absence of external pressure or is it also the presence of something—and if so, of what? What are the social and economic factors in society that make for the striving for freedom? Can freedom become a burden, too heavy for man to bear, something he tries to escape from? Why then is it that freedom is for many a cherished goal and for others a threat? Is there not also, perhaps, besides an innate desire for freedom, an instinctive wish for submission? If there is not, how can we account for the attraction which submission to a leader has for so many today? Is submission always to an overt authority, or is there also submission to internalized authorities, such as duty or conscience, to inner compulsions or to anonymous authorities like public opinion? Is there a hidden satisfaction in submitting, and what is its essence? What is it that creates in men an insatiable lust for power? Is it the strength of their vital energy—or is it a fundamental weakness and inability to experience life spontaneously and lovingly? What are the psychological conditions that make for the strength of these strivings? What are the social conditions upon which such psychological conditions in turn are based? Analysis of the human aspect of freedom and of authoritarianism forces us to consider a general problem, namely, that of the role which psychological factors play as active forces in the social process; and this eventually leads to the problem of the interaction of psychological, economic, and ideological factors in the social process. Any attempt to understand the attraction which Fascism exercises upon great nations compels us to recognize the role of psychological factors. For we are dealing here with a political system which, essentially, does not appeal to rational forces of self-interest, but which arouses and mobilizes diabolical forces in man which we had believed to be nonexistent, or at least to have died out long ago. The familiar picture of man in the last centuries was one of a rational being whose actions were determined by his self-interest and the ability to act according to it. Even writers like Hobbes, who recognized lust for power and hostility as driving forces in man, explained the existence of these forces as a logical result of self-interest: since men are equal and thus have the same wish for happiness, and since there is not enough wealth to satisfy them all to the same extent, they necessarily fight against each other and want power to secure the future enjoyment of what they have at present. But Hobbes’s picture became outmoded. The more the middle class succeeded in breaking down the power of the former political or religious rulers, the more men succeeded in mastering nature, and the more millions of individuals became economically independent, the more did one come to believe in a rational world and in man as an essentially rational being. The dark and diabolical forces of man’s nature were relegated to the Middle Ages and to still earlier periods of history, and they were explained by lack of knowledge or by the cunning schemes of deceitful kings and priests. One looked back upon these periods as one might at a volcano which for a long time has ceased to be a menace. One felt secure and confident that the achievements of modern democracy had wiped out all sinister forces; the world looked bright and safe like the well-lit streets of a modern city. Wars were supposed to be the last relics of older times and one needed just one more war to end war; economic crises were supposed to be accidents, even though these accidents continued to happen with a certain regularity. When Fascism came into power, most people were unprepared, both theoretically and practically. They were unable to believe that man could exhibit such propensities for evil, such lust for power, such disregard for the rights of the weak, or such yearning for submission. Only a few had been aware of the rumbling of the volcano preceding the outbreak. Nietzsche had disturbed the complacent optimism of the nineteenth century; so had Marx in a different way. Another warning had come somewhat later from Freud. To be sure, he and most of his disciples had only a very naive notion of what goes on in society, and most of his applications of psychology to social problems were misleading constructions; yet, by devoting his interest to the phenomena of individual emotional and mental disturbances, he led us to the top of the volcano and made us look into the boiling crater. Freud went further than anybody before him in directing attention to the observation and analysis of the irrational and unconscious forces which determine parts of human behavior. He and his followers in modern psychology not only uncovered the irrational and unconscious sector of man’s nature, the existence of which had been neglected by modern rationalism; he also showed that these irrational phenomena followed certain laws and therefore could be understood rationally. He taught us to understand the language of dreams and somatic symptoms as well as the irrationalities in human behavior. He discovered that these irrationalities as well as the whole character structure of an individual were reactions to the influences exercised by the outside world and particularly by those occurring in early childhood. But Freud was so imbued with the spirit of his culture that he could not go beyond certain limits which were set by it. These very limits became limitations for his understanding even of the sick individual; they handicapped his understanding of the normal individual and of the irrational phenomena operating in social life. Since this book stresses the role of psychological factors in the whole of the social process and since this analysis is based on some of the fundamental discoveries of Freud—particularly those concerning the operation of unconscious forces in man’s character and their dependence on external influences—I think it will be helpful to the reader to know from the outset some of the general principles of our approach, and also the main differences between this approach and the classical Freudian concepts.3 Freud accepted the traditional belief in a basic dichotomy between man and society, as well as the traditional doctrine of the evilness of human nature. Man, to him, is fundamentally antisocial. Society must domesticate him, must allow some direct satisfaction of biological—and hence, ineradicable—drives; but for the most part society must refine and adroitly check man’s basic impulses. In consequence of this suppression of natural impulses by society something miraculous happens: the suppressed drives turn into strivings that are culturally valuable and thus become the human basis for culture. Freud chose the word sublimation for this strange transformation from suppression into civilized behavior. If the amount of suppression is greater than the capacity for sublimation, individuals become neurotic and it is necessary to allow the lessening of suppression. Generally, however, there is a reverse relation between satisfaction of man’s drives and culture: the more suppression, the more culture (and the more danger of neurotic disturbances). The relation of the individual to society in Freud’s theory is essentially a static one: the individual remains virtually the same and becomes changed only in so far as society exercises greater pressure on his natural drives (and thus enforces more sublimation) or allows more satisfaction (and thus sacrifices culture). Like the so-called basic instincts of man which earlier psychologists accepted, Freud’s conception of human nature was essentially a reflection of the most important drives to be seen in modern man. For Freud, the individual of his culture represented “man,” and those passions and anxieties that are characteristic for man in modern society were looked upon as eternal forces rooted in the biological constitution of man. While we could give many illustrations of this point (as, for instance, the social basis for the hostility prevalent today in modern man, the Oedipus complex, the so-called castration complex in women), I want only to give one more illustration which is particularly important because it concerns the whole concept of man as a social being. Freud always considers the individual in his relations to others. These relations as Freud sees them, however, are similar to the economic relations to others which are characteristic of the individual in capitalist society. Each person works for himself, individualistically, at his own risk, and not primarily in co-operation with others. But he is not a Robinson Crusoe; he needs others, as customers, as employees, or as employers. He must buy and sell, give and take. The market, whether it is the commodity or the labor market, regulates these relations. Thus the individual, primarily alone and self-sufficient, enters into economic relations with others as means to one end: to sell and to buy. Freud’s concept of human relations is essentially the same: the individual appears fully equipped with biologically given drives, which need to'
# )
